# API
API_PORT=4000
DATABASE_URL=postgres://bitloot:bitloot@localhost:5432/bitloot
REDIS_URL=redis://localhost:6379

# Security
JWT_SECRET=change-me-in-production
REFRESH_TOKEN_SECRET=change-me-in-production
CORS_ORIGIN=http://localhost:3000

# Storage (R2)
R2_ACCOUNT_ID=
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
R2_BUCKET=bitloot-keys
R2_ENDPOINT=

# Emails (Resend)
RESEND_API_KEY=
EMAIL_FROM=no-reply@bitloot.io
# Newsletter Audience ID - Get from Resend Dashboard -> Audiences
# Create an audience at: https://resend.com/audiences
RESEND_AUDIENCE_ID=

# Payments (NOWPayments) - Sandbox Testing
# Get API_KEY from: https://nowpayments.io/dashboard -> API Settings
# Get IPN_SECRET from: https://nowpayments.io/dashboard -> IPN Settings
# For local dev: Use ngrok (ngrok http 4000) and set CALLBACK_URL to ngrok URL
# Example: NOWPAYMENTS_CALLBACK_URL=https://abc123.ngrok.io/payments/ipn
NOWPAYMENTS_API_KEY=sk_test_xxxxx
NOWPAYMENTS_IPN_SECRET=ipn_secret_xxxxx
NOWPAYMENTS_BASE=https://api-sandbox.nowpayments.io
NOWPAYMENTS_CALLBACK_URL=https://your-staging.example.com/payments/ipn

# Kinguin eCommerce API v2
# Get credentials from: https://www.kinguin.net/integration/dashboard/stores
# KINGUIN_API_KEY: 32-character API key (used in X-Api-Key header)
# KINGUIN_BASE_URL: Production API gateway (gateway.kinguin.net)
# KINGUIN_WEBHOOK_SECRET: Shared secret for webhook authentication
KINGUIN_API_KEY=
KINGUIN_BASE_URL=https://gateway.kinguin.net/esa/api
KINGUIN_WEBHOOK_SECRET=

# Bot Protection (Cloudflare Turnstile)
# Get credentials from: https://dash.cloudflare.com/ -> Turnstile
# TURNSTILE_SITE_KEY: Public key (safe to expose in frontend)
# TURNSTILE_SECRET_KEY: Secret key (server-side only, never expose)
TURNSTILE_SITE_KEY=
TURNSTILE_SECRET_KEY=
TURNSTILE_ENABLED=true
# Frontend public variable (Note: NEXT_PUBLIC_ prefix)
NEXT_PUBLIC_TURNSTILE_SITE_KEY=

# Environment
NODE_ENV=development

# ============= LEVEL 4 OBSERVABILITY & SECURITY =============

# One-Time Password (OTP) Configuration
# OTP_TTL: Time-to-live for OTP codes in seconds (default: 5 minutes = 300)
OTP_TTL=300
# OTP_MAX_ATTEMPTS: Maximum number of verification attempts before lockout (default: 3)
OTP_MAX_ATTEMPTS=3
# OTP_RATE_LIMIT_WINDOW: Rate limit window in seconds for OTP requests (default: 60 seconds)
OTP_RATE_LIMIT_WINDOW=60

# Prometheus Metrics Configuration (Level 4)
# PROMETHEUS_ENABLED: Enable Prometheus metrics collection (default: true)
PROMETHEUS_ENABLED=true
# METRICS_PORT: Port for /metrics endpoint (default: 9090, exposed via 9090->9090 Docker mapping)
# Access metrics: curl http://localhost:9090/metrics or http://localhost:4000/metrics (secured with AdminGuard)
METRICS_PORT=9090

# Structured Logging Configuration (Level 4)
# STRUCTURED_LOG_FORMAT: Log format ('json' for JSON structured logs, 'text' for human-readable)
# Recommendation: Use 'json' for production (works with log aggregation systems like Datadog/ELK)
STRUCTURED_LOG_FORMAT=json
# LOG_LEVEL: Minimum logging level ('debug', 'info', 'warn', 'error')
# Recommendation: 'info' for production, 'debug' for development
LOG_LEVEL=info

# Email Deliverability Headers (Level 4)
# EMAIL_PRIORITY_UNDERPAID: Priority for underpaid/failed payment notices ('high' = X-Priority: 1)
# EMAIL_PRIORITY_TRANSACTIONAL: Priority for order confirmations ('normal' = X-Priority: 3)
# Recommendation: Keep transactional low priority to avoid spam folder, keep payment alerts high
EMAIL_PRIORITY_UNDERPAID=high
EMAIL_PRIORITY_TRANSACTIONAL=normal

# Email Unsubscribe Configuration (Level 4)
# EMAIL_UNSUBSCRIBE_URL_BASE: Base URL for one-click unsubscribe links
# Example: https://bitloot.io/emails/unsubscribe?email={email}&token={token}
EMAIL_UNSUBSCRIBE_URL_BASE=https://bitloot.io/emails/unsubscribe

# Webhook Retry Configuration (Level 4)
# WEBHOOK_MAX_RETRIES: Maximum number of webhook delivery retries (default: 5)
WEBHOOK_MAX_RETRIES=5
# WEBHOOK_RETRY_DELAY_MS: Initial delay between retries in milliseconds (exponential backoff applied)
WEBHOOK_RETRY_DELAY_MS=2000

# HMAC Signature Verification (Level 4)
# Enable strict HMAC verification for all webhooks (default: true)
# Set to false only for local testing with mock webhooks
WEBHOOK_SIGNATURE_VERIFICATION_ENABLED=true

# Rate Limiting Configuration (Level 4)
# RATE_LIMIT_OTP_PER_EMAIL: Max OTP requests per email per window (default: 3)
RATE_LIMIT_OTP_PER_EMAIL=3
# RATE_LIMIT_OTP_WINDOW_MS: Rate limit window in milliseconds (default: 60000 = 1 minute)
RATE_LIMIT_OTP_WINDOW_MS=60000

# Idempotency & Duplicate Prevention (Level 4)
# ENABLE_WEBHOOK_IDEMPOTENCY: Prevent duplicate webhook processing via database unique constraints
ENABLE_WEBHOOK_IDEMPOTENCY=true
# ENABLE_EMAIL_IDEMPOTENCY: Use Idempotency-Key header for email sends (RFC 7231)
ENABLE_EMAIL_IDEMPOTENCY=true

# Admin Monitoring Configuration (Level 4)
# ADMIN_METRICS_REFRESH_INTERVAL: Dashboard metrics refresh interval in seconds (default: 30)
ADMIN_METRICS_REFRESH_INTERVAL=30
# ADMIN_WEBHOOK_REPLAY_ENABLED: Allow admins to replay failed webhooks (default: true)
ADMIN_WEBHOOK_REPLAY_ENABLED=true

```
