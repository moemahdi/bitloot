{"openapi":"3.0.0","paths":{"/healthz":{"get":{"operationId":"HealthController_healthz","summary":"Health check endpoint","parameters":[],"responses":{"200":{"description":"Service is healthy"}},"tags":["Health"]}},"/orders":{"post":{"operationId":"OrdersController_create","summary":"Create a new order","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrderDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderResponseDto"}}}}},"tags":["orders"]}},"/orders/{id}":{"get":{"operationId":"OrdersController_get","summary":"Get order by ID (requires ownership)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderResponseDto"}}}},"401":{"description":"Unauthorized - missing or invalid JWT"},"403":{"description":"Forbidden - order does not belong to user"},"404":{"description":"Order not found"}},"tags":["orders"],"security":[{"JWT-auth":[]}]}},"/orders/{id}/reservation":{"patch":{"operationId":"OrdersController_setReservation","summary":"Set Kinguin reservation ID (test/internal use)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderResponseDto"}}}}},"tags":["orders"]}},"/webhooks/nowpayments/ipn":{"post":{"operationId":"IpnHandlerController_handleNowpaymentsIpn","summary":"NOWPayments IPN Webhook Handler","description":"Receives instant payment notifications from NOWPayments. Verifies signature, deduplicates by payment ID, updates order status, and queues fulfillment if payment is complete. Always returns 200 OK to prevent webhook retries.","parameters":[{"name":"x-nowpayments-signature","required":true,"in":"header","schema":{"type":"string"}},{"name":"X-NOWPAYMENTS-SIGNATURE","in":"header","description":"HMAC-SHA512 signature of request body (hex string)","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NowpaymentsIpnRequestDto"}}}},"responses":{"200":{"description":"Webhook received and processed (or queued for processing). Always 200 OK regardless of outcome.","schema":{"example":{"ok":true,"message":"Webhook processed","processed":true,"webhookId":"660e8400-e29b-41d4-a716-446655440001"}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NowpaymentsIpnResponseDto"}}}}},"tags":["Webhooks"]}},"/webhooks/admin/list":{"get":{"operationId":"IpnHandlerController_adminListWebhooks","summary":"[ADMIN] List all webhook logs with pagination","description":"Requires admin role in JWT token. Returns delivery history for all webhooks.","parameters":[{"name":"page","required":true,"in":"query","schema":{"type":"string"}},{"name":"limit","required":true,"in":"query","schema":{"type":"string"}},{"name":"webhookType","required":true,"in":"query","schema":{"type":"string"}},{"name":"processed","required":true,"in":"query","schema":{"type":"string"}},{"name":"paymentStatus","required":true,"in":"query","schema":{"type":"string"}},{"name":"orderId","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"Paginated webhook logs list","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"externalId":{"type":"string"},"webhookType":{"type":"string","example":"nowpayments_ipn"},"processed":{"type":"boolean"},"signatureValid":{"type":"boolean"},"paymentStatus":{"type":"string","example":"finished"},"orderId":{"type":"string","format":"uuid","nullable":true},"paymentId":{"type":"string","nullable":true},"error":{"type":"string","nullable":true},"attemptCount":{"type":"number"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}}},"total":{"type":"number"},"page":{"type":"number"},"limit":{"type":"number"},"totalPages":{"type":"number"},"hasNextPage":{"type":"boolean"}}}}}},"401":{"description":"Unauthorized or missing JWT"},"403":{"description":"Forbidden: user is not admin"}},"tags":["Webhooks"],"security":[{"JWT-auth":[]}]}},"/webhooks/resend/bounce":{"post":{"operationId":"ResendBounceController_handleBounce","summary":"Receive email bounce events from Resend","description":"Webhook endpoint for Resend bounce/complaint events. Updates suppression list.","parameters":[],"requestBody":{"required":true,"description":"Resend webhook event payload","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResendBounceEventDto"}}}},"responses":{"200":{"description":"Bounce event processed"}},"tags":["Webhooks"]}},"/metrics":{"get":{"operationId":"MetricsController_getMetrics","summary":"Get Prometheus metrics","parameters":[],"responses":{"200":{"description":"Prometheus metrics in text format","content":{"application/json":{"schema":{"type":"string"}}}}},"tags":["Metrics"]}},"/emails/unsubscribe":{"post":{"operationId":"EmailUnsubscribeController_unsubscribe","summary":"Unsubscribe from marketing emails (RFC 8058)","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UnsubscribeEmailDto"}}}},"responses":{"200":{"description":"Email successfully unsubscribed (or was already unsubscribed)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UnsubscribeResponseDto"}}}},"400":{"description":"Invalid token or malformed request"}},"tags":["Emails"]}},"/admin/stats":{"get":{"operationId":"AdminController_getDashboardStats","summary":"Get dashboard statistics","description":"Returns aggregated revenue, orders, users, and sales history","parameters":[],"responses":{"200":{"description":"Dashboard statistics","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DashboardStatsDto"}}}}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/orders":{"get":{"operationId":"AdminController_getOrders","summary":"Get paginated list of orders","description":"Returns all orders with payment and fulfillment status","parameters":[{"name":"limit","required":false,"in":"query","schema":{"example":50,"type":"number"}},{"name":"offset","required":false,"in":"query","schema":{"example":0,"type":"number"}},{"name":"email","required":false,"in":"query","schema":{"example":"user@example.com","type":"string"}},{"name":"status","required":false,"in":"query","schema":{"example":"fulfilled","type":"string"}}],"responses":{"200":{"description":"Paginated orders list","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"status":{"type":"string"},"total":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"payment":{"type":"object","nullable":true,"properties":{"id":{"type":"string"},"provider":{"type":"string"},"status":{"type":"string"}}}}}},"total":{"type":"number"},"limit":{"type":"number"},"offset":{"type":"number"}}}}}}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/payments":{"get":{"operationId":"AdminController_getPayments","summary":"Get paginated list of payments","description":"Returns payments with order info, filtered by provider and status","parameters":[{"name":"limit","required":false,"in":"query","schema":{"example":50,"type":"number"}},{"name":"offset","required":false,"in":"query","schema":{"example":0,"type":"number"}},{"name":"provider","required":false,"in":"query","schema":{"example":"nowpayments","type":"string"}},{"name":"status","required":false,"in":"query","schema":{"example":"finished","type":"string"}}],"responses":{"200":{"description":"Paginated payments list","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"orderId":{"type":"string"},"externalId":{"type":"string"},"status":{"type":"string"},"provider":{"type":"string"},"priceAmount":{"type":"string"},"priceCurrency":{"type":"string"},"payAmount":{"type":"string"},"payCurrency":{"type":"string"},"order":{"type":"object","properties":{"email":{"type":"string"}}},"createdAt":{"type":"string","format":"date-time"}}}},"total":{"type":"number"},"limit":{"type":"number"},"offset":{"type":"number"}}}}}}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/reservations":{"get":{"operationId":"AdminController_getReservations","summary":"Get paginated list of Kinguin reservations","description":"Returns orders with Kinguin reservation status and ID","parameters":[{"name":"limit","required":false,"in":"query","schema":{"example":50,"type":"number"}},{"name":"offset","required":false,"in":"query","schema":{"example":0,"type":"number"}},{"name":"kinguinReservationId","required":false,"in":"query","schema":{"example":"res_123456","type":"string"}},{"name":"status","required":false,"in":"query","schema":{"example":"fulfilled","type":"string"}}],"responses":{"200":{"description":"Paginated reservations list","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"status":{"type":"string"},"kinguinReservationId":{"type":"string"},"createdAt":{"type":"string","format":"date-time"}}}},"total":{"type":"number"},"limit":{"type":"number"},"offset":{"type":"number"}}}}}}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/webhook-logs":{"get":{"operationId":"AdminController_getWebhookLogs","summary":"Get paginated list of webhook logs","description":"Returns webhook history with processing status","parameters":[{"name":"limit","required":false,"in":"query","schema":{"example":50,"type":"number"}},{"name":"offset","required":false,"in":"query","schema":{"example":0,"type":"number"}},{"name":"webhookType","required":false,"in":"query","schema":{"example":"nowpayments_ipn","type":"string"}},{"name":"paymentStatus","required":false,"in":"query","schema":{"example":"processed","type":"string"}}],"responses":{"200":{"description":"Paginated webhook logs","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"externalId":{"type":"string"},"webhookType":{"type":"string"},"paymentStatus":{"type":"string"},"payload":{"type":"object"},"processed":{"type":"boolean"},"signature":{"type":"string"},"signatureValid":{"type":"boolean"},"orderId":{"type":"string"},"paymentId":{"type":"string"},"result":{"type":"string"},"sourceIp":{"type":"string"},"attemptCount":{"type":"number"},"error":{"type":"string"},"createdAt":{"type":"string","format":"date-time"}}}},"total":{"type":"number"},"limit":{"type":"number"},"offset":{"type":"number"}}}}}}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/webhook-logs/{id}":{"get":{"operationId":"AdminController_getWebhookLog","summary":"Get webhook log details","description":"Returns full webhook log with payload for inspection","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Webhook log details with payload","content":{"application/json":{"schema":{"type":"object","properties":{"id":{"type":"string"},"webhookType":{"type":"string"},"externalId":{"type":"string"},"paymentStatus":{"type":"string"},"payload":{"type":"object"},"error":{"type":"string"},"createdAt":{"type":"string","format":"date-time"}}}}}},"404":{"description":"Webhook log not found"}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/key-audit/{orderId}":{"get":{"operationId":"AdminController_getKeyAuditTrail","summary":"Get key access audit trail","description":"Returns when keys were revealed to the customer","parameters":[{"name":"orderId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Key access audit trail","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"viewed":{"type":"boolean"},"viewedAt":{"type":"string","format":"date-time"},"createdAt":{"type":"string","format":"date-time"}}}}}}},"404":{"description":"Order not found or has no keys"}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/webhook-logs/{id}/replay":{"post":{"operationId":"AdminController_replayWebhook","summary":"Replay failed webhook","description":"Marks webhook for reprocessing by resetting status to pending","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Webhook marked for replay"},"400":{"description":"Cannot replay processed webhook"},"404":{"description":"Webhook log not found"}},"tags":["Admin"],"security":[{"JWT-auth":[]}]}},"/admin/ops/feature-flags":{"get":{"operationId":"AdminOpsController_getFeatureFlags","summary":"Get all feature flags","parameters":[],"responses":{"200":{"description":"List of all feature flags with status","content":{"application/json":{"schema":{"type":"array","items":{"properties":{"name":{"type":"string"},"enabled":{"type":"boolean"},"description":{"type":"string"}}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]},"post":{"operationId":"AdminOpsController_createFeatureFlag","summary":"Create new feature flag","parameters":[],"responses":{"201":{"description":"Feature flag created","content":{"application/json":{"schema":{"properties":{"success":{"type":"boolean"},"message":{"type":"string"}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/feature-flags/{name}":{"get":{"operationId":"AdminOpsController_getFeatureFlag","summary":"Get single feature flag","parameters":[{"name":"name","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Feature flag status","content":{"application/json":{"schema":{"properties":{"enabled":{"type":"boolean"},"description":{"type":"string"}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]},"patch":{"operationId":"AdminOpsController_updateFeatureFlag","summary":"Update feature flag","parameters":[{"name":"name","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Feature flag updated","content":{"application/json":{"schema":{"properties":{"success":{"type":"boolean"},"message":{"type":"string"}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/queues/stats":{"get":{"operationId":"AdminOpsController_getQueueStats","summary":"Get BullMQ queue statistics","parameters":[],"responses":{"200":{"description":"Queue statistics (waiting, active, failed)","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"properties":{"waiting":{"type":"number"},"active":{"type":"number"},"failed":{"type":"number"},"delayed":{"type":"number"},"paused":{"type":"number"},"total":{"type":"number"}}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/queues/{name}/details":{"get":{"operationId":"AdminOpsController_getQueueDetails","summary":"Get detailed queue information","parameters":[{"name":"name","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Queue details including recent jobs","content":{"application/json":{"schema":{"properties":{"name":{"type":"string"},"stats":{"properties":{"waiting":{"type":"number"},"active":{"type":"number"},"failed":{"type":"number"},"delayed":{"type":"number"}}},"recentJobs":{"type":"array","items":{"properties":{"id":{"type":"string"},"data":{"type":"object"},"state":{"type":"string"},"progress":{"type":"number"},"attempts":{"type":"number"}}}}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/balance":{"get":{"operationId":"AdminOpsController_getBalance","summary":"Get current balance and account status","parameters":[],"responses":{"200":{"description":"Current balance from payment provider","content":{"application/json":{"schema":{"properties":{"nowpayments":{"properties":{"available":{"type":"string"},"currency":{"type":"string"},"lastUpdated":{"type":"string"}}},"status":{"properties":{"api_connected":{"type":"boolean"},"webhooks_enabled":{"type":"boolean"},"sandbox_mode":{"type":"boolean"}}}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/balance/details":{"get":{"operationId":"AdminOpsController_getBalanceDetails","summary":"Get detailed balance by currency","parameters":[],"responses":{"200":{"description":"Detailed balance information","content":{"application/json":{"schema":{"properties":{"accounts":{"type":"array","items":{"properties":{"currency":{"type":"string"},"balance":{"type":"string"},"pending":{"type":"string"},"locked":{"type":"string"}}}},"totalUSD":{"type":"string"},"lastSync":{"type":"string"}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/admin/ops/health":{"get":{"operationId":"AdminOpsController_getSystemHealth","summary":"Get system health status","parameters":[],"responses":{"200":{"description":"System health check results","content":{"application/json":{"schema":{"properties":{"api":{"properties":{"healthy":{"type":"boolean"},"uptime":{"type":"string"}}},"database":{"properties":{"healthy":{"type":"boolean"},"responseTime":{"type":"string"}}},"redis":{"properties":{"healthy":{"type":"boolean"},"responseTime":{"type":"string"}}},"queues":{"properties":{"healthy":{"type":"boolean"},"failedJobs":{"type":"number"}}}}}}}}},"tags":["Admin - Operations"],"security":[{"JWT-auth":[]}]}},"/auth/request-otp":{"post":{"operationId":"AuthController_requestOtp","summary":"Request OTP code via email","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RequestOtpDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OtpResponseDto"}}}}},"tags":["Authentication"]}},"/auth/verify-otp":{"post":{"operationId":"AuthController_verifyOtp","summary":"Verify OTP code and get JWT tokens","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyOtpDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponseDto"}}}}},"tags":["Authentication"]}},"/auth/refresh":{"post":{"operationId":"AuthController_refresh","summary":"Refresh JWT access token","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponseDto"}}}}},"tags":["Authentication"]}},"/auth/forgot-password":{"post":{"operationId":"AuthController_forgotPassword","summary":"Request password reset email","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ForgotPasswordDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ForgotPasswordResponseDto"}}}}},"tags":["Authentication"]}},"/auth/reset-password":{"post":{"operationId":"AuthController_resetPassword","summary":"Reset password with token","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResetPasswordDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResetPasswordResponseDto"}}}}},"tags":["Authentication"]}},"/auth/logout":{"post":{"operationId":"AuthController_logout","summary":"Logout user","parameters":[],"responses":{"204":{"description":""}},"tags":["Authentication"]}},"/auth/test/get-otp":{"post":{"operationId":"AuthController_getOtpForTesting","summary":"[TEST ONLY] Get OTP for testing","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"example":{"code":"123456"}}}}}},"tags":["Authentication"]}},"/payments/create":{"post":{"operationId":"PaymentsController_create","summary":"Create payment invoice","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePaymentDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentResponseDto"}}}}},"tags":["payments"]}},"/payments/ipn":{"post":{"operationId":"PaymentsController_ipn","summary":"NOWPayments IPN webhook","description":"Receive payment status updates from NOWPayments. Signature verified with HMAC-SHA512.","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IpnRequestDto"}}}},"responses":{"200":{"description":"Webhook processed successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IpnResponseDto"}}}},"400":{"description":"Invalid request body"},"401":{"description":"Invalid HMAC signature"}},"tags":["payments"]}},"/payments/jobs/{jobId}/status":{"get":{"operationId":"PaymentsController_getJobStatus","summary":"Get payment job status","parameters":[{"name":"jobId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Job status with progress"},"404":{"description":"Job not found"}},"tags":["payments"]}},"/payments/admin/list":{"get":{"operationId":"PaymentsController_adminListPayments","summary":"[ADMIN] List all payments with pagination","description":"Requires admin role in JWT token","parameters":[{"name":"page","required":true,"in":"query","schema":{"type":"string"}},{"name":"limit","required":true,"in":"query","schema":{"type":"string"}},{"name":"status","required":true,"in":"query","schema":{"type":"string"}},{"name":"provider","required":true,"in":"query","schema":{"type":"string"}},{"name":"orderId","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"Paginated payments list","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"orderId":{"type":"string","format":"uuid"},"externalId":{"type":"string"},"status":{"type":"string","enum":["created","waiting","confirming","finished","underpaid","failed"]},"provider":{"type":"string"},"priceAmount":{"type":"number"},"priceCurrency":{"type":"string"},"payAmount":{"type":"number"},"payCurrency":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}}},"total":{"type":"number"},"page":{"type":"number"},"limit":{"type":"number"},"totalPages":{"type":"number"},"hasNextPage":{"type":"boolean"}}}}}},"401":{"description":"Unauthorized or missing JWT"},"403":{"description":"Forbidden: user is not admin"}},"tags":["payments"],"security":[{"JWT-auth":[]}]}},"/catalog/products":{"get":{"operationId":"CatalogController_listProducts","summary":"List products with filtering and pagination","parameters":[{"name":"q","required":false,"in":"query","description":"Search query (full-text)","schema":{"type":"string"}},{"name":"platform","required":false,"in":"query","description":"Filter by platform (Steam, Epic, etc)","schema":{"type":"string"}},{"name":"region","required":false,"in":"query","description":"Filter by region (US, EU, etc)","schema":{"type":"string"}},{"name":"category","required":false,"in":"query","description":"Filter by category","schema":{"type":"string"}},{"name":"sort","required":false,"in":"query","schema":{"enum":["newest","price_asc","price_desc","rating"],"type":"string"}},{"name":"limit","required":false,"in":"query","description":"Items per page (â‰¤ 100)","schema":{"type":"number"}},{"name":"offset","required":false,"in":"query","description":"Pagination offset","schema":{"type":"number"}}],"responses":{"200":{"description":"Paginated product list","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProductListResponseDto"}}}}},"tags":["Catalog"]}},"/catalog/products/{slug}":{"get":{"operationId":"CatalogController_getProduct","summary":"Get single product by slug","parameters":[{"name":"slug","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Product details","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProductResponseDto"}}}},"404":{"description":"Product not found"}},"tags":["Catalog"]}},"/admin/catalog/products":{"get":{"operationId":"AdminProductsController_listAll","summary":"List all products (admin - no pagination limit)","parameters":[{"name":"search","required":true,"in":"query","schema":{"type":"string"}},{"name":"platform","required":true,"in":"query","schema":{"type":"string"}},{"name":"region","required":true,"in":"query","schema":{"type":"string"}},{"name":"published","required":true,"in":"query","schema":{"type":"string"}},{"name":"source","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"All products regardless of publish status","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}}}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]},"post":{"operationId":"AdminProductsController_create","summary":"Create custom product","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateProductDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/products/{id}":{"get":{"operationId":"AdminProductsController_getById","summary":"Get product by ID (admin)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}},"404":{"description":"Product not found"}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]},"patch":{"operationId":"AdminProductsController_update","summary":"Update product details","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateProductDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}},"404":{"description":"Product not found"}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]},"delete":{"operationId":"AdminProductsController_delete","summary":"Delete product","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"204":{"description":"Product deleted"},"404":{"description":"Product not found"}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/products/{id}/publish":{"patch":{"operationId":"AdminProductsController_publish","summary":"Publish product (set isPublished=true)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}},"404":{"description":"Product not found"}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/products/{id}/unpublish":{"patch":{"operationId":"AdminProductsController_unpublish","summary":"Unpublish product (set isPublished=false)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminProductResponseDto"}}}},"404":{"description":"Product not found"}},"tags":["Admin - Catalog Products"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/rules":{"get":{"operationId":"AdminPricingController_listAll","summary":"List all pricing rules (admin only)","parameters":[{"name":"productId","required":true,"in":"query","schema":{"type":"string"}},{"name":"ruleType","required":true,"in":"query","schema":{"type":"string"}},{"name":"isActive","required":true,"in":"query","schema":{"type":"string"}},{"name":"page","required":true,"in":"query","schema":{"type":"string"}},{"name":"limit","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminPricingRulesListResponseDto"}}}}},"tags":["Admin - Catalog Pricing"],"security":[{"JWT-auth":[]}]},"post":{"operationId":"AdminPricingController_create","summary":"Create new pricing rule (admin only)","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePricingRuleDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminPricingRuleResponseDto"}}}}},"tags":["Admin - Catalog Pricing"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/rules/{id}":{"get":{"operationId":"AdminPricingController_getById","summary":"Get pricing rule by ID (admin only)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminPricingRuleResponseDto"}}}}},"tags":["Admin - Catalog Pricing"],"security":[{"JWT-auth":[]}]},"patch":{"operationId":"AdminPricingController_update","summary":"Update pricing rule (admin only)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePricingRuleDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminPricingRuleResponseDto"}}}}},"tags":["Admin - Catalog Pricing"],"security":[{"JWT-auth":[]}]},"delete":{"operationId":"AdminPricingController_delete","summary":"Delete pricing rule (admin only)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"204":{"description":""}},"tags":["Admin - Catalog Pricing"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/reprice":{"post":{"operationId":"AdminRepriceController_triggerReprice","summary":"Trigger repricing job","description":"Enqueues a BullMQ job to recalculate prices for all products or a specific product based on dynamic pricing rules","parameters":[{"name":"productId","required":false,"in":"query","description":"Optional: Reprice only this product ID","schema":{"type":"string"}}],"responses":{"202":{"description":"Repricing job enqueued successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RepriceJobResponseDto"}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Admin only"}},"tags":["Admin - Catalog Repricing"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/reprice/status":{"get":{"operationId":"AdminRepriceController_getRepriceStatus","summary":"Check repricing job status","description":"Get detailed status of a specific repricing job by ID","parameters":[{"name":"jobId","required":true,"in":"query","description":"The BullMQ job ID to check","schema":{"type":"string"}}],"responses":{"200":{"description":"Job status retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RepriceJobStatusResponseDto"}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Admin only"},"404":{"description":"Job not found"}},"tags":["Admin - Catalog Repricing"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/sync":{"post":{"operationId":"AdminSyncController_triggerSync","summary":"Trigger Kinguin catalog sync","description":"Enqueues a BullMQ job to fetch latest products from Kinguin API and update local database","parameters":[{"name":"fullSync","required":false,"in":"query","description":"If true, performs full sync. Otherwise, incremental sync","schema":{"type":"boolean"}}],"responses":{"202":{"description":"Sync job enqueued successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SyncJobResponseDto"}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Admin only"}},"tags":["Admin - Catalog Sync"],"security":[{"JWT-auth":[]}]}},"/admin/catalog/sync/status":{"get":{"operationId":"AdminSyncController_getSyncStatus","summary":"Check sync job status","description":"Get detailed status of a specific Kinguin sync job by ID","parameters":[{"name":"jobId","required":true,"in":"query","description":"The BullMQ job ID to check","schema":{"type":"string"}}],"responses":{"200":{"description":"Job status retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SyncJobStatusResponseDto"}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden - Admin only"},"404":{"description":"Job not found"}},"tags":["Admin - Catalog Sync"],"security":[{"JWT-auth":[]}]}},"/fulfillment/{id}/status":{"get":{"operationId":"FulfillmentController_getStatus","summary":"Get order fulfillment status (requires ownership)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FulfillmentStatusDto"}}}},"401":{"description":"Unauthorized - missing or invalid JWT"},"403":{"description":"Forbidden - order does not belong to user"},"404":{"description":"Order not found"}},"tags":["Fulfillment"],"security":[{"JWT-auth":[]}]}},"/fulfillment/{id}/download-link":{"get":{"operationId":"FulfillmentController_getDownloadLink","summary":"Generate delivery link for fulfilled order (requires ownership)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryLinkDto"}}}},"400":{"description":"Order not fulfilled"},"401":{"description":"Unauthorized - missing or invalid JWT"},"403":{"description":"Forbidden - order does not belong to user"},"404":{"description":"Order not found"}},"tags":["Fulfillment"],"security":[{"JWT-auth":[]}]}},"/fulfillment/{id}/reveal/{itemId}":{"post":{"operationId":"FulfillmentController_revealMyKey","summary":"Reveal encrypted key (requires ownership)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}},{"name":"itemId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevealedKeyDto"}}}},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden"},"404":{"description":"Order or item not found"}},"tags":["Fulfillment"],"security":[{"JWT-auth":[]}]}},"/fulfillment/{id}/reveal-key/{itemId}":{"post":{"operationId":"FulfillmentController_revealKey","summary":"Admin: Reveal encrypted key (requires admin role)","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}},{"name":"itemId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevealedKeyDto"}}}},"400":{"description":"Order not fulfilled or key unavailable"},"401":{"description":"Unauthorized - not admin"},"404":{"description":"Order or item not found"}},"tags":["Fulfillment"],"security":[{"JWT-auth":[]}]}},"/fulfillment/health/check":{"get":{"operationId":"FulfillmentController_healthCheck","summary":"Health check for fulfillment service","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthCheckResultDto"}}}}},"tags":["Fulfillment"]}},"/kinguin/webhooks":{"post":{"operationId":"KinguinController_handleWebhook","summary":"Webhook receiver for Kinguin order deliveries","parameters":[{"name":"X-KINGUIN-SIGNATURE","in":"header","description":"HMAC signature for webhook verification","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/WebhookPayloadDto"}}}},"responses":{"200":{"description":"","content":{"application/json":{"schema":{"properties":{"ok":{"type":"boolean"}}}}}},"401":{"description":"Invalid webhook signature"}},"tags":["Kinguin"]}},"/kinguin/status/{reservationId}":{"get":{"operationId":"KinguinController_getStatus","summary":"Query Kinguin order delivery status","parameters":[{"name":"reservationId","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Order status retrieved","content":{"application/json":{"schema":{"properties":{"id":{"type":"string"},"status":{"type":"string"},"key":{"type":"string"}}}}}},"404":{"description":"Reservation not found"}},"tags":["Kinguin"]}},"/users/me":{"get":{"operationId":"UsersController_getProfile","summary":"Get current user profile","parameters":[],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponseDto"}}}}},"tags":["Users"],"security":[{"JWT-auth":[]}]}},"/users/me/password":{"patch":{"operationId":"UsersController_updatePassword","summary":"Update user password","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePasswordDto"}}}},"responses":{"200":{"description":"Password updated"}},"tags":["Users"],"security":[{"JWT-auth":[]}]}},"/users/me/orders":{"get":{"operationId":"UsersController_getOrders","summary":"Get user's orders","parameters":[],"responses":{"200":{"description":""}},"tags":["Users"],"security":[{"JWT-auth":[]}]}},"/admin/audit-logs":{"post":{"operationId":"AuditLogController_create","summary":"Create audit log entry","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateAuditLogDto"}}}},"responses":{"201":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditLogResponseDto"}}}}},"tags":["Audit Logs"],"security":[{"JWT-auth":[]}]},"get":{"operationId":"AuditLogController_query","summary":"Query audit logs with filtering","parameters":[{"name":"adminUserId","required":false,"in":"query","schema":{"type":"string"}},{"name":"action","required":false,"in":"query","schema":{"type":"string"}},{"name":"target","required":false,"in":"query","schema":{"type":"string"}},{"name":"fromDate","required":false,"in":"query","schema":{"type":"string"}},{"name":"toDate","required":false,"in":"query","schema":{"type":"string"}},{"name":"limit","required":false,"in":"query","schema":{"minimum":1,"maximum":100,"default":50,"type":"number"}},{"name":"offset","required":false,"in":"query","schema":{"minimum":0,"default":0,"type":"number"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedAuditLogsDto"}}}}},"tags":["Audit Logs"],"security":[{"JWT-auth":[]}]}},"/admin/audit-logs/export":{"get":{"operationId":"AuditLogController_export","summary":"Export audit logs as JSON","parameters":[{"name":"fromDate","required":true,"in":"query","schema":{"type":"string"}},{"name":"toDate","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AuditLogResponseDto"}}}}}},"tags":["Audit Logs"],"security":[{"JWT-auth":[]}]}}},"info":{"title":"BitLoot API","description":"Crypto-only e-commerce for instant delivery of digital goods","version":"0.0.1","contact":{}},"tags":[],"servers":[],"components":{"securitySchemes":{"JWT-auth":{"scheme":"bearer","bearerFormat":"JWT","type":"http"}},"schemas":{"CreateOrderDto":{"type":"object","properties":{"email":{"type":"string","example":"user@example.com"},"productId":{"type":"string","default":"demo-product","example":"demo-product"},"note":{"type":"string","example":"Demo order"},"captchaToken":{"type":"string","description":"Cloudflare Turnstile CAPTCHA token for bot protection"}},"required":["email","productId"]},"OrderItemResponseDto":{"type":"object","properties":{"id":{"type":"string"},"productId":{"type":"string"},"sourceType":{"type":"string","description":"Fulfillment source for this item","enum":["custom","kinguin"],"example":"custom"},"signedUrl":{"type":"object","nullable":true}},"required":["id","productId","sourceType","signedUrl"]},"OrderResponseDto":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"userId":{"type":"string"},"status":{"type":"string"},"sourceType":{"type":"string","description":"Overall order fulfillment source","enum":["custom","kinguin"],"example":"custom"},"kinguinReservationId":{"type":"string","description":"Kinguin reservation ID (present when sourceType is kinguin)"},"total":{"type":"string"},"items":{"type":"array","items":{"$ref":"#/components/schemas/OrderItemResponseDto"}},"createdAt":{"format":"date-time","type":"string"},"updatedAt":{"format":"date-time","type":"string"}},"required":["id","email","status","sourceType","total","items","createdAt","updatedAt"]},"NowpaymentsIpnRequestDto":{"type":"object","properties":{"payment_id":{"type":"string","description":"NOWPayments payment ID","example":"123456789"},"invoice_id":{"type":"string","description":"Order UUID from our system","example":"550e8400-e29b-41d4-a716-446655440000"},"order_id":{"type":"string","description":"Duplicate of invoice_id","example":"550e8400-e29b-41d4-a716-446655440000"},"payment_status":{"type":"string","description":"Payment status","enum":["waiting","confirming","finished","failed","underpaid"],"example":"finished"},"price_amount":{"type":"number","description":"Expected USD price amount","example":100},"price_currency":{"type":"string","description":"Price currency","example":"usd"},"pay_amount":{"type":"number","description":"Crypto amount paid","example":0.0025},"pay_currency":{"type":"string","description":"Cryptocurrency code","example":"btc"},"received_amount":{"type":"number","description":"Amount received after fees","example":0.0025},"received_currency":{"type":"string","description":"Crypto currency received","example":"btc"},"created_at":{"type":"string","description":"Payment created at","example":"2025-11-08T15:30:00Z"},"updated_at":{"type":"string","description":"Payment updated at","example":"2025-11-08T15:35:00Z"},"reference":{"type":"string","description":"Optional NOWPayments reference"}},"required":["payment_id","invoice_id","order_id","payment_status","price_amount","price_currency","pay_amount","pay_currency","received_amount","received_currency","created_at","updated_at"]},"NowpaymentsIpnResponseDto":{"type":"object","properties":{"ok":{"type":"boolean","description":"Webhook received successfully","example":true},"message":{"type":"string","description":"Response message","example":"Webhook received and processed"},"processed":{"type":"boolean","description":"Whether webhook was processed","example":true},"webhookId":{"type":"string","description":"Webhook log ID for audit trail","example":"550e8400-e29b-41d4-a716-446655440000"}},"required":["ok","message","processed","webhookId"]},"ResendBounceEventDto":{"type":"object","properties":{}},"UnsubscribeEmailDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address to unsubscribe","example":"user@example.com"},"token":{"type":"string","description":"Unsubscribe token (prevents unauthorized unsubscribes)","example":"550e8400-e29b-41d4-a716-446655440000"}},"required":["email","token"]},"UnsubscribeResponseDto":{"type":"object","properties":{"status":{"type":"string","description":"Unsubscribe status","example":"success"},"message":{"type":"string","description":"Human-readable message","example":"You have been successfully unsubscribed from BitLoot emails"},"email":{"type":"string","description":"Email that was unsubscribed","example":"user@example.com"},"unsubscribedAt":{"format":"date-time","type":"string","description":"When the unsubscribe took effect (ISO 8601)","example":"2025-11-12T14:32:00.000Z"}},"required":["status","message","email","unsubscribedAt"]},"DashboardStatsDto":{"type":"object","properties":{"totalRevenue":{"type":"number","description":"Total revenue in USD (cents)","example":125000},"totalOrders":{"type":"number","description":"Total number of orders","example":150},"totalUsers":{"type":"number","description":"Total number of registered users","example":85},"activeOrders":{"type":"number","description":"Active orders (pending/processing)","example":12},"revenueHistory":{"type":"array","description":"Revenue history for the last 7 days","items":{"type":"object","properties":{"date":{"type":"string","example":"2023-11-20"},"revenue":{"type":"number","example":1500}}}}},"required":["totalRevenue","totalOrders","totalUsers","activeOrders","revenueHistory"]},"RequestOtpDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address to send OTP to","example":"user@example.com"},"captchaToken":{"type":"string","description":"Cloudflare Turnstile CAPTCHA token (required if CAPTCHA enabled)","example":"0x4AAAAAABkpwy8Y38VB-QW9..."}},"required":["email"]},"OtpResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Whether OTP was sent successfully","example":true},"expiresIn":{"type":"number","description":"Seconds until OTP expires","example":300},"error":{"type":"string","description":"Error message if OTP request failed"}},"required":["success"]},"VerifyOtpDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address associated with OTP","example":"user@example.com"},"code":{"type":"string","description":"6-digit OTP code","example":"123456","minLength":6,"maxLength":6}},"required":["email","code"]},"UserResponseDto":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"},"emailConfirmed":{"type":"boolean"},"role":{"type":"string"},"createdAt":{"format":"date-time","type":"string"}},"required":["id","email","emailConfirmed","role","createdAt"]},"AuthResponseDto":{"type":"object","properties":{"accessToken":{"type":"string","description":"JWT access token (15 minute expiry)"},"refreshToken":{"type":"string","description":"JWT refresh token (7 day expiry)"},"user":{"description":"User info","allOf":[{"$ref":"#/components/schemas/UserResponseDto"}]}},"required":["accessToken","refreshToken","user"]},"ForgotPasswordDto":{"type":"object","properties":{"email":{"type":"string","description":"Email address to send reset link to","example":"user@example.com"}},"required":["email"]},"ForgotPasswordResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Whether reset email was sent","example":true},"message":{"type":"string","description":"Message to display to user","example":"If an account exists with this email, you will receive a password reset link."}},"required":["success","message"]},"ResetPasswordDto":{"type":"object","properties":{"token":{"type":"string","description":"Password reset token from email link","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."},"password":{"type":"string","description":"New password (min 8 characters)","example":"NewSecurePassword123!"}},"required":["token","password"]},"ResetPasswordResponseDto":{"type":"object","properties":{"success":{"type":"boolean","description":"Whether password was reset successfully","example":true},"message":{"type":"string","description":"Success message"}},"required":["success","message"]},"CreatePaymentDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID (UUID)","example":"550e8400-e29b-41d4-a716-446655440000"},"email":{"type":"string","description":"Customer email address","example":"customer@example.com"},"priceAmount":{"type":"string","description":"Total price amount","example":"49.99"},"priceCurrency":{"type":"string","description":"Price currency (fiat)","example":"usd"},"payCurrency":{"type":"string","description":"Cryptocurrency to accept (optional, user chooses at payment page)","example":"btc"}},"required":["orderId","email","priceAmount","priceCurrency"]},"PaymentResponseDto":{"type":"object","properties":{"invoiceId":{"type":"number","description":"NOWPayments invoice ID","example":123456},"invoiceUrl":{"type":"string","description":"Invoice URL for customer to complete payment","example":"https://nowpayments.io/invoice/..."},"statusUrl":{"type":"string","description":"Status tracking URL","example":"https://nowpayments.io/status/..."},"payAddress":{"type":"string","description":"Cryptocurrency payment address","example":"bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh"},"priceAmount":{"type":"number","description":"Amount to pay in fiat","example":49.99},"payAmount":{"type":"number","description":"Amount to pay in crypto","example":0.001234},"payCurrency":{"type":"string","description":"Cryptocurrency code","example":"btc"},"status":{"type":"string","description":"Payment status","example":"waiting"},"expirationDate":{"type":"string","description":"Payment expiration date (ISO string)","example":"2025-11-08T23:59:59Z"}},"required":["invoiceId","invoiceUrl","statusUrl","payAddress","priceAmount","payAmount","payCurrency","status","expirationDate"]},"IpnRequestDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID that maps to NOWPayments invoice order_id","example":"550e8400-e29b-41d4-a716-446655440000"},"externalId":{"type":"string","description":"NOWPayments external payment ID (same as invoiceId)","example":"fake_550e8400-..."},"status":{"type":"string","description":"Payment status from NOWPayments (waiting, confirming, finished, failed, etc)","example":"finished"},"payAmount":{"type":"number","description":"Amount paid in crypto","example":0.001234},"payCurrency":{"type":"string","description":"Cryptocurrency code","example":"btc"},"confirmations":{"type":"number","description":"Number of confirmations","example":0}},"required":["orderId","externalId","status"]},"IpnResponseDto":{"type":"object","properties":{"ok":{"type":"boolean","description":"Webhook processed successfully","example":true},"message":{"type":"string","description":"Optional message","example":"Payment processed"}},"required":["ok"]},"ProductResponseDto":{"type":"object","properties":{"id":{"type":"string","description":"Product unique identifier","example":"123e4567-e89b-12d3-a456-426614174000"},"slug":{"type":"string","description":"URL-friendly product identifier","example":"cyberpunk-2077-steam-us"},"title":{"type":"string","description":"Product title","example":"Cyberpunk 2077"},"subtitle":{"type":"string","description":"Product subtitle or edition","example":"Ultimate Edition"},"description":{"type":"string","description":"Detailed product description","example":"An open-world, action-adventure RPG set in the dark future of Night City"},"platform":{"type":"string","description":"Gaming platform","example":"Steam"},"region":{"type":"string","description":"Region code","example":"US"},"drm":{"type":"string","description":"DRM system","example":"Steam"},"ageRating":{"type":"string","description":"Age rating","example":"M - Mature 17+"},"category":{"type":"string","description":"Product category","example":"Games"},"price":{"type":"string","description":"Price in crypto (decimal string)","example":"59.99000000"},"currency":{"type":"string","description":"Currency code","example":"USD"},"isPublished":{"type":"boolean","description":"Whether product is published and visible","example":true},"imageUrl":{"type":"string","description":"Cover image URL","example":"https://cdn.bitloot.io/products/cyberpunk-2077-cover.jpg"},"createdAt":{"format":"date-time","type":"string","description":"Product creation timestamp","example":"2024-01-15T10:30:00Z"},"updatedAt":{"format":"date-time","type":"string","description":"Last update timestamp","example":"2024-01-20T15:45:00Z"}},"required":["id","slug","title","price","currency","isPublished","createdAt","updatedAt"]},"ProductListResponseDto":{"type":"object","properties":{"data":{"description":"Array of products","type":"array","items":{"$ref":"#/components/schemas/ProductResponseDto"}},"total":{"type":"number","description":"Total number of products matching filters","example":150},"limit":{"type":"number","description":"Items per page","example":24},"offset":{"type":"number","description":"Pagination offset","example":0},"pages":{"type":"number","description":"Total number of pages","example":7}},"required":["data","total","limit","offset","pages"]},"AdminProductResponseDto":{"type":"object","properties":{"id":{"type":"string"},"externalId":{"type":"string"},"sourceType":{"type":"string","description":"Product fulfillment source","enum":["custom","kinguin"],"example":"custom"},"kinguinOfferId":{"type":"string","description":"Kinguin offer ID (present when sourceType is kinguin)","example":"5c9b5e6b-89f6-4b3d-8f4e-abcdef123456"},"slug":{"type":"string"},"title":{"type":"string"},"name":{"type":"string"},"subtitle":{"type":"string"},"description":{"type":"string"},"platform":{"type":"string"},"region":{"type":"string"},"drm":{"type":"string"},"ageRating":{"type":"string"},"category":{"type":"string"},"cost":{"type":"string"},"price":{"type":"string"},"currency":{"type":"string"},"isPublished":{"type":"boolean"},"isCustom":{"type":"boolean"},"createdAt":{"format":"date-time","type":"string"},"updatedAt":{"format":"date-time","type":"string"},"deletedAt":{"format":"date-time","type":"string"}},"required":["id","sourceType","slug","title","name","cost","price","currency","isPublished","isCustom","createdAt","updatedAt"]},"CreateProductDto":{"type":"object","properties":{"sourceType":{"type":"string","description":"Product fulfillment source","enum":["custom","kinguin"],"default":"custom","example":"custom"},"kinguinOfferId":{"type":"string","description":"Kinguin offer ID (required when sourceType is kinguin)","example":"5c9b5e6b-89f6-4b3d-8f4e-abcdef123456"},"title":{"type":"string","description":"Product title"},"subtitle":{"type":"string","description":"Product subtitle"},"description":{"type":"string","description":"Product description"},"platform":{"type":"string","description":"Platform (steam, epic, gog, etc.)"},"region":{"type":"string","description":"Region (us, eu, asia, global)"},"drm":{"type":"string","description":"DRM type"},"ageRating":{"type":"string","description":"Age rating (PEGI-16, ESRB-M, etc.)"},"category":{"type":"string","description":"Category"},"cost":{"type":"string","description":"Wholesale cost (decimal string)","example":"45.00"},"price":{"type":"string","description":"Retail price (decimal string)","example":"59.99"},"currency":{"type":"string","description":"Currency code (USD, EUR, GBP)","default":"USD"},"isPublished":{"type":"boolean","description":"Is published to storefront?","default":false}},"required":["sourceType","title","cost","price","currency","isPublished"]},"UpdateProductDto":{"type":"object","properties":{"sourceType":{"type":"string","description":"Product fulfillment source","enum":["custom","kinguin"],"example":"custom"},"kinguinOfferId":{"type":"string","description":"Kinguin offer ID (required when sourceType is kinguin)","example":"5c9b5e6b-89f6-4b3d-8f4e-abcdef123456"},"title":{"type":"string","description":"Product title"},"subtitle":{"type":"string","description":"Product subtitle"},"description":{"type":"string","description":"Product description"},"platform":{"type":"string","description":"Platform"},"region":{"type":"string","description":"Region"},"drm":{"type":"string","description":"DRM type"},"ageRating":{"type":"string","description":"Age rating"},"category":{"type":"string","description":"Category"},"cost":{"type":"string","description":"Wholesale cost"},"price":{"type":"string","description":"Retail price"},"currency":{"type":"string","description":"Currency code"}}},"AdminPricingRuleResponseDto":{"type":"object","properties":{"id":{"type":"string"},"productId":{"type":"string"},"ruleType":{"type":"string"},"marginPercent":{"type":"string","nullable":true},"fixedMarkupMinor":{"type":"number","nullable":true},"floorMinor":{"type":"number","nullable":true},"capMinor":{"type":"number","nullable":true},"priority":{"type":"number"},"isActive":{"type":"boolean"},"createdAt":{"format":"date-time","type":"string"},"updatedAt":{"format":"date-time","type":"string"}},"required":["id","productId","ruleType","marginPercent","fixedMarkupMinor","floorMinor","capMinor","priority","isActive","createdAt","updatedAt"]},"AdminPricingRulesListResponseDto":{"type":"object","properties":{"data":{"type":"array","items":{"$ref":"#/components/schemas/AdminPricingRuleResponseDto"}},"total":{"type":"number"},"page":{"type":"number"},"limit":{"type":"number"},"totalPages":{"type":"number"}},"required":["data","total","page","limit","totalPages"]},"CreatePricingRuleDto":{"type":"object","properties":{"productId":{"type":"string","description":"Product ID (UUID)","format":"uuid"},"ruleType":{"type":"string","description":"Rule type","enum":["margin_percent","fixed_markup","floor_cap","dynamic_adjust"]},"marginPercent":{"type":"string","description":"Margin percentage (e.g., \"35.50\" for 35.5%)"},"fixedMarkupMinor":{"type":"number","description":"Fixed markup in minor units (cents)","minimum":0},"floorMinor":{"type":"number","description":"Floor price in minor units (cents)","minimum":0},"capMinor":{"type":"number","description":"Cap price in minor units (cents)","minimum":0},"priority":{"type":"number","description":"Rule priority (0 = highest)","default":0,"minimum":0},"isActive":{"type":"boolean","description":"Is rule active?","default":true}},"required":["productId","ruleType","priority","isActive"]},"UpdatePricingRuleDto":{"type":"object","properties":{"ruleType":{"type":"string","description":"Rule type","enum":["margin_percent","fixed_markup","floor_cap","dynamic_adjust"]},"marginPercent":{"type":"string","description":"Margin percentage (e.g., \"35.50\" for 35.5%)"},"fixedMarkupMinor":{"type":"number","description":"Fixed markup in minor units (cents)","minimum":0},"floorMinor":{"type":"number","description":"Floor price in minor units (cents)","minimum":0},"capMinor":{"type":"number","description":"Cap price in minor units (cents)","minimum":0},"priority":{"type":"number","description":"Rule priority (0 = highest)","minimum":0},"isActive":{"type":"boolean","description":"Is rule active?"}}},"RepriceJobResponseDto":{"type":"object","properties":{}},"RepriceJobStatusResponseDto":{"type":"object","properties":{}},"SyncJobResponseDto":{"type":"object","properties":{}},"SyncJobStatusResponseDto":{"type":"object","properties":{}},"FulfillmentStatusDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID","example":"550e8400-e29b-41d4-a716-446655440000"},"status":{"type":"string","description":"Current order status","example":"paid"},"itemsFulfilled":{"type":"number","description":"Number of items fulfilled","example":2},"itemsTotal":{"type":"number","description":"Total number of items in order","example":3},"allFulfilled":{"type":"boolean","description":"Whether all items are fulfilled","example":true},"updatedAt":{"format":"date-time","type":"string","description":"Last update timestamp","example":"2025-11-10T15:30:00.000Z"}},"required":["orderId","status","itemsFulfilled","itemsTotal","allFulfilled","updatedAt"]},"DeliveryLinkDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID","example":"550e8400-e29b-41d4-a716-446655440000"},"signedUrl":{"type":"string","description":"Signed download URL (expires in 15 min)","example":"https://r2-example.example.com/orders/550e8400.json?signature=xyz"},"expiresAt":{"format":"date-time","type":"string","description":"URL expiry timestamp (ISO8601)","example":"2025-11-08T14:15:00Z"},"itemCount":{"type":"number","description":"Number of items available","example":3},"message":{"type":"string","description":"Delivery message","example":"Your order is ready for download. Link expires in 15 minutes."}},"required":["orderId","signedUrl","expiresAt","itemCount","message"]},"RevealedKeyDto":{"type":"object","properties":{"orderId":{"type":"string","description":"Order ID","example":"550e8400-e29b-41d4-a716-446655440000"},"itemId":{"type":"string","description":"Item ID","example":"4f5d7890-1234-5678-9abc-def012345678"},"plainKey":{"type":"string","description":"Decrypted license key","example":"KEY-ABC123XYZ789"},"revealedAt":{"format":"date-time","type":"string","description":"Key revelation timestamp (ISO8601)","example":"2025-11-08T14:00:00Z"},"expiresAt":{"format":"date-time","type":"string","description":"Key expiration timestamp (ISO8601)","example":"2025-11-08T14:15:00Z"},"downloadCount":{"type":"number","description":"Number of times accessed","example":1},"accessInfo":{"type":"object","description":"Access information","example":{"ipAddress":"192.168.1.100","userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"}}},"required":["orderId","itemId","plainKey","revealedAt","expiresAt","downloadCount","accessInfo"]},"HealthCheckResultDto":{"type":"object","properties":{"service":{"type":"string","description":"Service name","example":"FulfillmentService"},"status":{"type":"string","description":"Health status","example":"healthy","enum":["healthy","degraded","unhealthy"]},"dependencies":{"type":"object","description":"Dependency status","example":{"r2Storage":true}},"timestamp":{"format":"date-time","type":"string","description":"Check timestamp (ISO8601)","example":"2025-11-08T14:00:00Z"},"error":{"type":"string","description":"Error message (if any)","example":"R2 storage connection timeout"}},"required":["service","status","dependencies","timestamp"]},"WebhookPayloadDto":{"type":"object","properties":{"reservationId":{"type":"string","description":"Kinguin reservation ID","example":"res-12345"},"status":{"type":"string","description":"Order fulfillment status","enum":["waiting","processing","ready","failed","cancelled"],"example":"ready"},"key":{"type":"string","description":"License key (only when status=ready)","example":"XXXXX-XXXXX-XXXXX-XXXXX"},"error":{"type":"string","description":"Error message (only when status=failed)","example":"Out of stock"},"timestamp":{"type":"number","description":"Webhook timestamp (Unix milliseconds)","example":1730000000000}},"required":["reservationId","status"]},"UpdatePasswordDto":{"type":"object","properties":{"oldPassword":{"type":"string"},"newPassword":{"type":"string"}},"required":["oldPassword","newPassword"]},"CreateAuditLogDto":{"type":"object","properties":{"adminUserId":{"type":"string","description":"Admin user ID"},"action":{"type":"string","description":"Action performed"},"target":{"type":"string","description":"Target resource"},"payload":{"type":"object","description":"Action payload"},"details":{"type":"string","description":"Action details"}},"required":["adminUserId","action","target"]},"AuditAdminDto":{"type":"object","properties":{"id":{"type":"string"},"email":{"type":"string"}},"required":["id","email"]},"AuditLogResponseDto":{"type":"object","properties":{"id":{"type":"string"},"adminUserId":{"type":"string"},"admin":{"$ref":"#/components/schemas/AuditAdminDto"},"action":{"type":"string"},"target":{"type":"string"},"payload":{"type":"object"},"details":{"type":"string"},"createdAt":{"format":"date-time","type":"string"}},"required":["id","adminUserId","action","target","createdAt"]},"PaginatedAuditLogsDto":{"type":"object","properties":{"data":{"type":"array","items":{"$ref":"#/components/schemas/AuditLogResponseDto"}},"total":{"type":"number"},"limit":{"type":"number"},"offset":{"type":"number"},"pages":{"type":"number"}},"required":["data","total","limit","offset","pages"]}}}}